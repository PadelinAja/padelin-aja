{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PadelinAja — Log in</title>

  <!-- Lato font -->
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f6f7;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --ring:rgba(94,44,165,.14);
      --purple:#5E2CA5;   /* brand primary */
      --purple-700:#4b2087;
      --yellow:#FFE955;   /* accent */
      --shadow:0 12px 30px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:"Lato",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
    }

    .wrap{
      max-width:1120px;
      margin:32px auto;
      padding:0 20px;
      display:grid;
      grid-template-columns:1.1fr .9fr;
      gap:36px;
      align-items:center;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
      .art{order:-1}
    }

    /* Left artwork */
    .art{
      position:relative;
      min-height:420px;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;        
    }
    .art img{
      width:min(720px,100%);
      height:auto;
      display:block;
      filter:drop-shadow(0 18px 32px rgba(0,0,0,.22));
    }
    .dot{
      position:absolute; right:-14px; top:88px;
      width:14px; height:14px; border-radius:999px; background:var(--yellow);
      box-shadow:0 5px 10px rgba(0,0,0,.12);
    }

    /* Card */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:28px;
    }
    .head{
      display:flex; flex-direction:column; align-items:center; gap:8px;
      margin-bottom:10px;
    }
    .logo{width:70px;height:70px;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.12)}
    .brand{font-weight:900; letter-spacing:.1px; margin-top:2px}
    .title{font-size:28px; font-weight:700; margin:0; color:#2b2b2b}

    /* Form */
    .form{margin-top:16px}
    .label{
      display:block; font-size:13px; color:#4b5563; margin:10px 2px 6px; font-weight:700;
    }
    .input{
      position:relative;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
    }
    .input input{
      width:100%; border:0; outline:0; padding:13px 48px 13px 14px; font-size:15px; color:var(--text); background:transparent;
    }
    .input:focus-within{box-shadow:0 0 0 4px var(--ring); border-color:var(--purple)}
    .toggle{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      border:0; background:transparent; color:var(--muted); font-weight:700; cursor:pointer;
    }

    .primary{
      width:100%; margin-top:16px;
      border:none; border-radius:32px; padding:14px 18px;
      background:var(--purple); color: #ffed2c;; font-weight:900; letter-spacing:.2px; font-size:16px;
      box-shadow:0 10px 24px rgba(94,44,165,.28); cursor:pointer; transition:filter .2s, transform .03s;
    }
    .primary:hover{filter:brightness(1.03)}
    .primary:active{transform:translateY(1px)}

    .divider{
      display:flex; align-items:center; gap:18px; color:#9ca3af; font-weight:700; margin:18px 0 14px;
    }
    .divider .line{height:1px; background:var(--border); flex:1}

    .google{
      width:100%;
      display:flex; align-items:center; justify-content:center; gap:10px;
      border:1px solid var(--border); border-radius:999px; background:#fff; padding:12px 16px;
      font-weight:800; color:#111827; text-decoration:none;
    }
    .glogo{width:18px;height:18px}

    .forgot{
      text-align:center; margin-top:12px;
    }
    .forgot a{color:#4b5563; font-size:13px; text-decoration:underline}

    .error{
      display:none; background:#fee4e2; color:#b42318; border:1px solid #fecdca;
      padding:10px 12px; border-radius:10px; margin-bottom:10px; font-weight:700;
    }

    /* Bottom signup bar */
    .signupbar{
      margin-top:18px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:20px 24px;
      text-align:center;
      font-weight:700;
      color:#1f2937;
    }
    .signupbar a{color:var(--purple); text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT IMAGE -->
    <aside class="art" aria-hidden="true">
      <span class="dot"></span>
      <img src="{% static 'main/img/login.png' %}" alt="Padel players">
    </aside>

    <!-- RIGHT LOGIN PANEL -->
    <section>
      <div class="card">
        <div class="head">
          <img class="logo" src="{% static 'main/img/PadelinAjaLogo.png' %}" alt="PadelinAja">
          <div class="brand">PadelinAja</div>
          <h1 class="title">Log in</h1>
        </div>

        <form id="loginForm" class="form" method="post" action="{% url 'main:login' %}">
          {% csrf_token %}
          <div id="loginError" class="error" role="alert"></div>

          <label class="label" for="username">Username</label>
          <div class="input">
            <input id="username" name="username" type="text" required autocomplete="username">
          </div>

          <label class="label" for="password">Your password</label>
          <div class="input">
            <input id="password" name="password" type="password" required autocomplete="current-password">
            <button type="button" class="toggle" data-target="password">Hide</button>
          </div>

          <button type="submit" class="primary">Log in</button>

          <div class="divider"><div class="line"></div>OR<div class="line"></div></div>

          <!-- Safe Google button (no social namespace) -->
          <a href="#" id="googleBtn" class="google">
            <svg class="glogo" viewBox="0 0 533.5 544.3" aria-hidden="true">
              <path d="M533.5 278.4c0-18.5-1.7-36.2-4.9-53.4H272v101h147.4c-6.3 34-25 62.8-53.5 82v68h86.5c50.4-46.4 80.1-114.7 80.1-197.6z"/>
              <path d="M272 544.3c72.4 0 133.2-23.8 177.6-64.3l-86.5-68c-24 16.1-54.8 25.7-91.1 25.7-69.9 0-129.2-47.2-150.4-110.7h-89.7v69.5c44 87.3 134.4 147.8 240.1 147.8z"/>
              <path d="M121.6 326.9c-10.3-30.8-10.3-64.1 0-94.9V162.5h-89.7c-39.4 78.8-39.4 170.6 0 249.4l89.7-69.5z"/>
              <path d="M272 107.7c37.2-.6 72.7 13 99.7 37.6l74.7-74.7C404.9 24.6 345 0 272 0 166.3 0 75.9 60.5 31.9 147.8l89.7 69.5C142.8 154.4 202.1 107.7 272 107.7z"/>
            </svg>
            Continue with Google
          </a>

          <div class="forgot">
            <a href="#" onclick="alert('Password reset is not set up yet.'); return false;">Forget your password?</a>
          </div>
        </form>
      </div>

      <!-- Bottom signup bar -->
      <div class="signupbar">
        Don’t have an account? <a href="{% url 'main:register' %}">Sign up</a>
      </div>
    </section>
  </div>

  <script>
    // Submit via AJAX 
    const form = document.getElementById('loginForm');
    const errorBox = document.getElementById('loginError');

    function csrf() {
      const el = document.querySelector('input[name=csrfmiddlewaretoken]');
      return el ? el.value : '';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorBox.style.display = 'none';
      errorBox.textContent = '';

      const res = await fetch(form.action, {
        method: 'POST',
        headers: { 'X-CSRFToken': csrf(), 'X-Requested-With': 'XMLHttpRequest' },
        body: new FormData(form),
        credentials: 'same-origin'
      });

      let data;
      try { data = await res.json(); } catch { data = { success:false, errors:'Unexpected server response.' }; }

      if (data.success) {
        window.location.href = data.redirect_url || "{% url 'main:show_main' %}";
      } else {
        errorBox.textContent = data.errors || 'Invalid credentials.';
        errorBox.style.display = 'block';
      }
    });

    // Show/Hide password
    document.querySelector('.toggle').addEventListener('click', function(){
      const input = document.getElementById(this.dataset.target);
      const show = input.type === 'password';
      input.type = show ? 'text' : 'password';
      this.textContent = show ? 'Hide' : 'Show';
    });

    // Google placeholder
    document.getElementById('googleBtn').addEventListener('click', (e)=>{
      e.preventDefault();
      alert('Google sign-in is not configured yet.');
    });
  </script>
</body>
</html>
